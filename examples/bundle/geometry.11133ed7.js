var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},e={},r={},i=t.parcelRequirefee5;null==i&&((i=function(t){if(t in e)return e[t].exports;if(t in r){var i=r[t];delete r[t];var o={id:t,exports:{}};return e[t]=o,i.call(o.exports,o,o.exports),o.exports}var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(t,e){r[t]=e},t.parcelRequirefee5=i);var o=i("ilwiq"),a=i("jiuw3"),n=i("5Rd1x"),s=i("7lx9d"),d=i("kp7Te");const l=new(0,(o=i("ilwiq")).Triangle),u=new(0,o.Vector3),c=new(0,o.Vector2),h=new(0,o.Vector2),p=new(0,o.Vector2);class m{constructor(t){this.geometry=t.geometry,this.randomFunction=Math.random,this.indexAttribute=this.geometry.index,this.positionAttribute=this.geometry.getAttribute("position"),this.normalAttribute=this.geometry.getAttribute("normal"),this.colorAttribute=this.geometry.getAttribute("color"),this.uvAttribute=this.geometry.getAttribute("uv"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(t){return this.weightAttribute=t?this.geometry.getAttribute(t):null,this}build(){const t=this.indexAttribute,e=this.positionAttribute,r=this.weightAttribute,i=t?t.count/3:e.count/3,o=new Float32Array(i);for(let a=0;a<i;a++){let i=1,n=3*a,s=3*a+1,d=3*a+2;t&&(n=t.getX(n),s=t.getX(s),d=t.getX(d)),r&&(i=r.getX(n)+r.getX(s)+r.getX(d)),l.a.fromBufferAttribute(e,n),l.b.fromBufferAttribute(e,s),l.c.fromBufferAttribute(e,d),i*=l.getArea(),o[a]=i}const a=new Float32Array(i);let n=0;for(let t=0;t<i;t++)n+=o[t],a[t]=n;return this.distribution=a,this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e,r,i){const o=this.sampleFaceIndex();return this.sampleFace(o,t,e,r,i)}sampleFaceIndex(){const t=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*t)}binarySearch(t){const e=this.distribution;let r=0,i=e.length-1,o=-1;for(;r<=i;){const a=Math.ceil((r+i)/2);if(0===a||e[a-1]<=t&&e[a]>t){o=a;break}t<e[a]?i=a-1:r=a+1}return o}sampleFace(t,e,r,i,o){let a=this.randomFunction(),n=this.randomFunction();a+n>1&&(a=1-a,n=1-n);const s=this.indexAttribute;let d=3*t,m=3*t+1,f=3*t+2;return s&&(d=s.getX(d),m=s.getX(m),f=s.getX(f)),l.a.fromBufferAttribute(this.positionAttribute,d),l.b.fromBufferAttribute(this.positionAttribute,m),l.c.fromBufferAttribute(this.positionAttribute,f),e.set(0,0,0).addScaledVector(l.a,a).addScaledVector(l.b,n).addScaledVector(l.c,1-(a+n)),void 0!==r&&(void 0!==this.normalAttribute?(l.a.fromBufferAttribute(this.normalAttribute,d),l.b.fromBufferAttribute(this.normalAttribute,m),l.c.fromBufferAttribute(this.normalAttribute,f),r.set(0,0,0).addScaledVector(l.a,a).addScaledVector(l.b,n).addScaledVector(l.c,1-(a+n)).normalize()):l.getNormal(r)),void 0!==i&&void 0!==this.colorAttribute&&(l.a.fromBufferAttribute(this.colorAttribute,d),l.b.fromBufferAttribute(this.colorAttribute,m),l.c.fromBufferAttribute(this.colorAttribute,f),u.set(0,0,0).addScaledVector(l.a,a).addScaledVector(l.b,n).addScaledVector(l.c,1-(a+n)),i.r=u.x,i.g=u.y,i.b=u.z),void 0!==o&&void 0!==this.uvAttribute&&(c.fromBufferAttribute(this.uvAttribute,d),h.fromBufferAttribute(this.uvAttribute,m),p.fromBufferAttribute(this.uvAttribute,f),o.set(0,0).addScaledVector(c,a).addScaledVector(h,n).addScaledVector(p,1-(a+n))),this}}var f=i("4CEV9");const w={operation:f.SUBTRACTION,wireframe:!1,displayBrushes:!1,shadows:!0,useGroups:!0,consolidateGroups:!0,randomize:()=>{F(),R()}};let b,g,A,y,S,O,B,T,v,M,E,I,x,C=new(0,f.Evaluator);C.attributes=["position","normal"],C.useGroups=!1;const N=new Map;function R(){const t=window.performance.now();let e=T[0];C.useGroups=w.useGroups,C.consolidateGroups=w.consolidateGroups;for(let t=1,r=T.length;t<r;t++){const r=T[t];e=C.evaluate(e,r,f.ADDITION),e.material=v}C.evaluate(B,e,w.operation,E),w.useGroups?E.material=E.material.map((t=>N.get(t))):E.material=N.get(B.material);const r=window.performance.now()-t,i=E.geometry;O.innerText=`${r.toFixed(3)}ms\n${i.groups.length} groups\n${Array.isArray(E.material)?E.material.length:1} materials`}function F(){for(let t=0;t<T.length;t++){const e=T[t];M.sample(e.position),e.position.applyMatrix4(B.matrixWorld),e.scale.setScalar(o.MathUtils.lerp(.05,.15,Math.random())),e.updateMatrixWorld()}}function V(){requestAnimationFrame(V),I.visible=w.wireframe,B.visible=w.displayBrushes,T.forEach((t=>t.visible=w.displayBrushes)),x.castShadow=w.shadows,b.render(A,g)}!async function(){O=document.getElementById("output"),b=new o.WebGLRenderer({antialias:!0}),b.setPixelRatio(window.devicePixelRatio),b.setSize(window.innerWidth,window.innerHeight),b.setClearColor(1118481,1),b.shadowMap.enabled=!0,b.shadowMap.type=o.PCFSoftShadowMap,document.body.appendChild(b.domElement),A=new o.Scene,x=new o.DirectionalLight(16777215,3.5),x.position.set(1,2,1),A.add(x,new o.AmbientLight(11583173,.35));const t=x.shadow.camera;x.castShadow=!0,x.shadow.mapSize.setScalar(4096),x.shadow.bias=1e-5,x.shadow.normalBias=.01,t.left=t.bottom=-2.5,t.right=t.top=2.5,t.updateProjectionMatrix(),g=new o.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50),g.position.set(0,.65,2.5),g.far=100,g.updateProjectionMatrix(),y=new(0,n.OrbitControls)(g,b.domElement);const e=new o.Mesh(new o.PlaneGeometry,new o.ShadowMaterial({opacity:.05}));e.material.color.set(14743546),e.rotation.x=-Math.PI/2,e.scale.setScalar(10),e.position.y=-.5,e.receiveShadow=!0,A.add(e);const r=(await(new(0,s.GLTFLoader)).setMeshoptDecoder(d.MeshoptDecoder).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/stanford-bunny/bunny.glb")).scene.children[0].geometry;r.computeVertexNormals(),B=new(0,f.Brush)(r,new o.MeshStandardMaterial),B.position.y=-.5,B.updateMatrixWorld(),B.receiveShadow=!0,A.add(B),v=new o.MeshStandardMaterial,T=[],M=new m(B),M.build();for(let t=0;t<50;t++){const t=new(0,f.Brush)(new o.SphereGeometry(1,15,15),v);t.receiveShadow=!0,A.add(t),T.push(t)}let i;B.material.opacity=.15,B.material.transparent=!0,B.material.depthWrite=!1,B.material.polygonOffset=!0,B.material.polygonOffsetFactor=.1,B.material.polygonOffsetUnits=.1,B.material.side=o.DoubleSide,B.material.premultipliedAlpha=!0,B.material.color.set(14743546),v.opacity=.15,v.transparent=!0,v.depthWrite=!1,v.polygonOffset=!0,v.polygonOffsetFactor=.1,v.polygonOffsetUnits=.1,v.side=o.DoubleSide,v.premultipliedAlpha=!0,v.roughness=.25,v.color.set(5099745),i=B.material.clone(),i.opacity=1,i.transparent=!1,i.depthWrite=!0,N.set(B.material,i),i=v.clone(),i.opacity=1,i.transparent=!1,i.depthWrite=!0,N.set(v,i),E=new o.Mesh(new o.BufferGeometry,new o.MeshStandardMaterial({roughness:.1,flatShading:!1,polygonOffset:!0,polygonOffsetUnits:1,polygonOffsetFactor:1})),E.castShadow=!0,E.receiveShadow=!0,A.add(E),I=new o.Mesh(E.geometry,new o.MeshBasicMaterial({wireframe:!0,color:0,opacity:.15,transparent:!0})),I.material.color.set(5398),A.add(I),S=new(0,a.GUI),S.add(w,"operation",{ADDITION:f.ADDITION,SUBTRACTION:f.SUBTRACTION,REVERSE_SUBTRACTION:f.REVERSE_SUBTRACTION,INTERSECTION:f.INTERSECTION,DIFFERENCE:f.DIFFERENCE,HOLLOW_SUBTRACTION:f.HOLLOW_SUBTRACTION,HOLLOW_INTERSECTION:f.HOLLOW_INTERSECTION}).onChange((()=>{R()})),S.add(w,"displayBrushes"),S.add(w,"shadows"),S.add(w,"wireframe"),S.add(w,"useGroups").onChange(R),S.add(w,"consolidateGroups").onChange(R),S.add(w,"randomize"),window.addEventListener("resize",(function(){g.aspect=window.innerWidth/window.innerHeight,g.updateProjectionMatrix(),b.setSize(window.innerWidth,window.innerHeight)}),!1),F(),R(),V()}();
//# sourceMappingURL=geometry.11133ed7.js.map
